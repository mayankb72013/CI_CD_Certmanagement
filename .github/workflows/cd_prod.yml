name: Deploy to staging
on: 
   push: 
      branches: [main]

jobs:
   redeploy_everything:
     runs-on: ubuntu-latest
     name: Deploying everything to the staging cluster
     steps:
        - run: |
            echo ${{ secrets.SSH_PRIVATE_KEY_AWS }} &> ~/ssh_key
            ssh -i ~/ssh_key ubuntu@13.60.166.224
            cd CI_CD_Certmanagement/ && git pull
            pnpm install
            pnpm run build
            pm2 restart all
           